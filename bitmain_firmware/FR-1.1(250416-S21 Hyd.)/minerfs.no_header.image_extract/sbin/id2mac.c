/* This file was generated by the Hex-Rays decompiler version 9.2.0.250908.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>

#include <stdarg.h>


//-------------------------------------------------------------------------
// Function declarations

int init_proc();
void sub_103AC();
// size_t fread(void *ptr, size_t size, size_t n, FILE *stream);
// char *getenv(const char *name);
// int puts(const char *s);
// int _libc_start_main(int (*main)(int, char **, char **), int argc, char **ubp_av, void (*init)(), void (*fini)(), void (*rtld_fini)(), void *stack_end);
// int _gmon_start__(void); weak
// size_t strlen(const char *s);
// int fclose(FILE *stream);
// int sprintf(char *s, const char *format, ...);
// int __fastcall fopen64(_DWORD, _DWORD); weak
// void abort(void);
int __fastcall main(int a1, char **a2, char **a3); // idb
void __noreturn start(void (*a1)(), int a2, int a3, int a4, ...);
int sub_10498();
char *sub_104BC();
__int64 sub_104E0();
char *sub_1050C();
int sub_10570();
int __fastcall sub_105B0(char *a1, char *a2);
int __fastcall sub_106C8(_BYTE *a1);
int __fastcall init(int a1, int a2, int a3);
int nullsub_1(); // weak
void term_proc();

//-------------------------------------------------------------------------
// Data declarations

_DWORD dword_108FC[256] =
{
  0,
  79764919,
  159529838,
  222504665,
  319059676,
  398814059,
  445009330,
  507990021,
  638119352,
  583659535,
  797628118,
  726387553,
  890018660,
  835552979,
  1015980042,
  944750013,
  1276238704,
  1221641927,
  1167319070,
  1095957929,
  1595256236,
  1540665371,
  1452775106,
  1381403509,
  1780037320,
  1859660671,
  1671105958,
  1733955601,
  2031960084,
  2111593891,
  1889500026,
  1952343757,
  -1742489888,
  -1662866601,
  -1851683442,
  -1788833735,
  -1960329156,
  -1880695413,
  -2103051438,
  -2040207643,
  -1104454824,
  -1159051537,
  -1213636554,
  -1284997759,
  -1389417084,
  -1444007885,
  -1532160278,
  -1603531939,
  -734892656,
  -789352409,
  -575645954,
  -646886583,
  -952755380,
  -1007220997,
  -827056094,
  -898286187,
  -231047128,
  -151282273,
  -71779514,
  -8804623,
  -515967244,
  -436212925,
  -390279782,
  -327299027,
  881225847,
  809987520,
  1023691545,
  969234094,
  662832811,
  591600412,
  771767749,
  717299826,
  311336399,
  374308984,
  453813921,
  533576470,
  25881363,
  88864420,
  134795389,
  214552010,
  2023205639,
  2086057648,
  1897238633,
  1976864222,
  1804852699,
  1867694188,
  1645340341,
  1724971778,
  1587496639,
  1516133128,
  1461550545,
  1406951526,
  1302016099,
  1230646740,
  1142491917,
  1087903418,
  -1398421865,
  -1469785312,
  -1524105735,
  -1578704818,
  -1079922613,
  -1151291908,
  -1239184603,
  -1293773166,
  -1968362705,
  -1905510760,
  -2094067647,
  -2014441994,
  -1716953613,
  -1654112188,
  -1876203875,
  -1796572374,
  -525066777,
  -462094256,
  -382327159,
  -302564546,
  -206542021,
  -143559028,
  -97365931,
  -17609246,
  -960696225,
  -1031934488,
  -817968335,
  -872425850,
  -709327229,
  -780559564,
  -600130067,
  -654598054,
  1762451694,
  1842216281,
  1619975040,
  1682949687,
  2047383090,
  2127137669,
  1938468188,
  2001449195,
  1325665622,
  1271206113,
  1183200824,
  1111960463,
  1543535498,
  1489069629,
  1434599652,
  1363369299,
  622672798,
  568075817,
  748617968,
  677256519,
  907627842,
  853037301,
  1067152940,
  995781531,
  51762726,
  131386257,
  177728840,
  240578815,
  269590778,
  349224269,
  429104020,
  491947555,
  -248556018,
  -168932423,
  -122852000,
  -60002089,
  -500490030,
  -420856475,
  -341238852,
  -278395381,
  -685261898,
  -739858943,
  -559578920,
  -630940305,
  -1004286614,
  -1058877219,
  -845023740,
  -916395085,
  -1119974018,
  -1174433591,
  -1262701040,
  -1333941337,
  -1371866206,
  -1426332139,
  -1481064244,
  -1552294533,
  -1690935098,
  -1611170447,
  -1833673816,
  -1770699233,
  -2009983462,
  -1930228819,
  -2119160460,
  -2056179517,
  1569362073,
  1498123566,
  1409854455,
  1355396672,
  1317987909,
  1246755826,
  1192025387,
  1137557660,
  2072149281,
  2135122070,
  1912620623,
  1992383480,
  1753615357,
  1816598090,
  1627664531,
  1707420964,
  295390185,
  358241886,
  404320391,
  483945776,
  43990325,
  106832002,
  186451547,
  266083308,
  932423249,
  861060070,
  1041341759,
  986742920,
  613929101,
  542559546,
  756411363,
  701822548,
  -978770311,
  -1050133554,
  -869589737,
  -924188512,
  -693284699,
  -764654318,
  -550540341,
  -605129092,
  -475935807,
  -413084042,
  -366743377,
  -287118056,
  -257573603,
  -194731862,
  -114850189,
  -35218492,
  -1984365303,
  -1921392450,
  -2143631769,
  -2063868976,
  -1698919467,
  -1635936670,
  -1824608069,
  -1744851700,
  -1347415887,
  -1418654458,
  -1506661409,
  -1561119128,
  -1129027987,
  -1200260134,
  -1254728445,
  -1309196108
}; // weak
char a0123456789abcd[17] = "0123456789abcdef"; // weak
_UNKNOWN *off_20F10 = (_UNKNOWN *)0x10525; // weak
_UNKNOWN *off_20F14 = (_UNKNOWN *)0x1050D; // weak
_DWORD dword_21040[256] =
{
  0,
  4129,
  8258,
  12387,
  16516,
  20645,
  24774,
  28903,
  33032,
  37161,
  41290,
  45419,
  49548,
  53677,
  57806,
  61935,
  4657,
  528,
  12915,
  8786,
  21173,
  17044,
  29431,
  25302,
  37689,
  33560,
  45947,
  41818,
  54205,
  50076,
  62463,
  58334,
  9314,
  13379,
  1056,
  5121,
  25830,
  29895,
  17572,
  21637,
  42346,
  46411,
  34088,
  38153,
  58862,
  62927,
  50604,
  54669,
  13907,
  9842,
  5649,
  1584,
  30423,
  26358,
  22165,
  18100,
  46939,
  42874,
  38681,
  34616,
  63455,
  59390,
  55197,
  51132,
  18628,
  22757,
  26758,
  30887,
  2112,
  6241,
  10242,
  14371,
  51660,
  55789,
  59790,
  63919,
  35144,
  39273,
  43274,
  47403,
  23285,
  19156,
  31415,
  27286,
  6769,
  2640,
  14899,
  10770,
  56317,
  52188,
  64447,
  60318,
  39801,
  35672,
  47931,
  43802,
  27814,
  31879,
  19684,
  23749,
  11298,
  15363,
  3168,
  7233,
  60846,
  64911,
  52716,
  56781,
  44330,
  48395,
  36200,
  40265,
  32407,
  28342,
  24277,
  20212,
  15891,
  11826,
  7761,
  3696,
  65439,
  61374,
  57309,
  53244,
  48923,
  44858,
  40793,
  36728,
  37256,
  33193,
  45514,
  41451,
  53516,
  49453,
  61774,
  57711,
  4224,
  161,
  12482,
  8419,
  20484,
  16421,
  28742,
  24679,
  33721,
  37784,
  41979,
  46042,
  49981,
  54044,
  58239,
  62302,
  689,
  4752,
  8947,
  13010,
  16949,
  21012,
  25207,
  29270,
  46570,
  42443,
  38312,
  34185,
  62830,
  58703,
  54572,
  50445,
  13538,
  9411,
  5280,
  1153,
  29798,
  25671,
  21540,
  17413,
  42971,
  47098,
  34713,
  38840,
  59231,
  63358,
  50973,
  55100,
  9939,
  14066,
  1681,
  5808,
  26199,
  30326,
  17941,
  22068,
  55628,
  51565,
  63758,
  59695,
  39368,
  35305,
  47498,
  43435,
  22596,
  18533,
  30726,
  26663,
  6336,
  2273,
  14466,
  10403,
  52093,
  56156,
  60223,
  64286,
  35833,
  39896,
  43963,
  48026,
  19061,
  23124,
  27191,
  31254,
  2801,
  6864,
  10931,
  14994,
  64814,
  60687,
  56684,
  52557,
  48554,
  44427,
  40424,
  36297,
  31782,
  27655,
  23652,
  19525,
  15522,
  11395,
  7392,
  3265,
  61215,
  65342,
  53085,
  57212,
  44955,
  49082,
  36825,
  40952,
  28183,
  32310,
  20053,
  24180,
  11923,
  16050,
  3793,
  7920
}; // weak
char byte_21440; // weak
int dword_21448; // weak
__int64 qword_21450; // weak
__int64 qword_21458; // weak
// extern _UNKNOWN __gmon_start__; weak


//----- (000103A0) --------------------------------------------------------
int init_proc()
{
  return sub_10498();
}

//----- (000103AC) --------------------------------------------------------
void sub_103AC()
{
  JUMPOUT(0);
}
// 103B8: control flows out of bounds to 0

//----- (00010438) --------------------------------------------------------
int __fastcall main(int a1, char **a2, char **a3)
{
  char s[20]; // [sp+4h] [bp-40h] BYREF
  char v5[44]; // [sp+18h] [bp-2Ch] BYREF

  sub_106C8(v5);
  sub_105B0(v5, s);
  puts(s);
  return 0;
}

//----- (00010468) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void __noreturn start(void (*a1)(), int a2, int a3, int a4, ...)
{
  int v4; // [sp-4h] [bp-4h]
  va_list va; // [sp+0h] [bp+0h] BYREF

  va_start(va, a4);
  _libc_start_main(main, v4, (char **)va, (void (*)())init, (void (*)())nullsub_1, a1, va);
  abort();
}
// 10472: positive sp value 4 has been found
// 10484: variable 'v4' is possibly undefined
// 108B0: using guessed type int init();
// 108EC: using guessed type int nullsub_1();

//----- (00010498) --------------------------------------------------------
int sub_10498()
{
  int result; // r0

  if ( &__gmon_start__ )
    return _gmon_start__();
  return result;
}
// 103F0: using guessed type int _gmon_start__(void);

//----- (000104BC) --------------------------------------------------------
char *sub_104BC()
{
  return &byte_21440;
}
// 21440: using guessed type char byte_21440;

//----- (000104E0) --------------------------------------------------------
__int64 sub_104E0()
{
  __int64 result; // r0

  LODWORD(result) = &byte_21440;
  HIDWORD(result) = 0;
  return result;
}
// 21440: using guessed type char byte_21440;

//----- (0001050C) --------------------------------------------------------
char *sub_1050C()
{
  char *result; // r0

  if ( !byte_21440 )
  {
    result = sub_104BC();
    byte_21440 = 1;
  }
  return result;
}
// 21440: using guessed type char byte_21440;

//----- (00010570) --------------------------------------------------------
int sub_10570()
{
  return 0;
}

//----- (000105B0) --------------------------------------------------------
int __fastcall sub_105B0(char *a1, char *a2)
{
  char *v4; // r0
  size_t v5; // r0
  unsigned __int8 *v6; // r0
  unsigned __int8 *v7; // r12
  unsigned int v8; // r2
  int v9; // t1
  unsigned int v10; // r1
  int v11; // t1
  int v12; // lr
  int v13; // r0
  size_t v14; // r3
  int v15; // r5
  int v16; // r2
  int v17; // r12
  int v19; // r1
  int v20; // r2
  int v21; // r3

  v4 = getenv("CPUID");
  if ( !v4 )
  {
    v5 = strlen(a1);
    if ( v5 )
      goto LABEL_3;
LABEL_10:
    v14 = v5;
    v13 = 255;
    v16 = v14;
    v17 = 255;
    v15 = 255;
    v12 = 255;
    return sprintf(a2, "%02x:%02x:%02x:%02x:%02x:%02x", v16, v14, v12, v15, v17, v13);
  }
  v19 = *((_DWORD *)v4 + 1);
  v20 = *((_DWORD *)v4 + 2);
  v21 = *((_DWORD *)v4 + 3);
  *(_DWORD *)a1 = *(_DWORD *)v4;
  *((_DWORD *)a1 + 1) = v19;
  *((_DWORD *)a1 + 2) = v20;
  *((_DWORD *)a1 + 3) = v21;
  v5 = strlen(a1);
  if ( !v5 )
    goto LABEL_10;
LABEL_3:
  v6 = (unsigned __int8 *)&a1[v5];
  v7 = (unsigned __int8 *)a1;
  v8 = 0;
  do
  {
    v9 = *v7++;
    v8 = (unsigned __int16)dword_21040[v9 ^ (v8 >> 8)] ^ (unsigned __int16)((_WORD)v8 << 8);
  }
  while ( v7 != v6 );
  v10 = -1;
  do
  {
    v11 = (unsigned __int8)*a1++;
    v10 = dword_108FC[v11 ^ HIBYTE(v10)] ^ (v10 << 8);
  }
  while ( a1 != (char *)v6 );
  v12 = (unsigned __int8)v10;
  v13 = HIBYTE(v10);
  v14 = v8 >> 8;
  v15 = BYTE1(v10);
  v16 = v8 & 0xFE;
  v17 = BYTE2(v10);
  return sprintf(a2, "%02x:%02x:%02x:%02x:%02x:%02x", v16, v14, v12, v15, v17, v13);
}
// 108FC: using guessed type _DWORD dword_108FC[256];
// 21040: using guessed type _DWORD dword_21040[256];

//----- (000106C8) --------------------------------------------------------
int __fastcall sub_106C8(_BYTE *a1)
{
  FILE *v2; // r6
  size_t v3; // r10
  __int64 v4; // r0
  __int64 v5; // r2
  unsigned int v6; // r8
  unsigned int v7; // lr
  unsigned int v8; // kr00_4
  const char *v9; // r7
  int v10; // r1
  int v12; // t1
  int v13; // r3
  int v14; // r3
  int v15; // t1
  _QWORD v17[2]; // [sp+0h] [bp-10h]

  if ( dword_21448 )
  {
    v4 = qword_21450;
    v5 = qword_21458;
LABEL_9:
    v6 = (v4 >> 9) ^ HIDWORD(v4);
    v7 = (v5 >> 9) ^ HIDWORD(v5);
    HIDWORD(qword_21450) = HIDWORD(v5) ^ (HIDWORD(v5) >> 5) ^ v6 ^ (v6 >> 18);
    LODWORD(qword_21450) = (v5 >> 5)
                         ^ v5
                         ^ v4
                         ^ ((_DWORD)v4 << 23)
                         ^ ((((unsigned int)v4 ^ ((_DWORD)v4 << 23)) >> 18) | (v6 << 14));
    v8 = qword_21450 + v5;
    HIDWORD(v5) = (unsigned __int64)(qword_21450 + v5) >> 32;
    LODWORD(qword_21458) = v5
                         ^ ((_DWORD)v5 << 23)
                         ^ ((((unsigned int)v5 ^ ((_DWORD)v5 << 23)) >> 18) | (v7 << 14))
                         ^ qword_21450
                         ^ (qword_21450 >> 5);
    v9 = "xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx";
    v10 = 0;
    HIDWORD(qword_21458) = v7 ^ (v7 >> 18) ^ HIDWORD(qword_21450) ^ (HIDWORD(qword_21450) >> 5);
    LODWORD(v5) = 120;
    v17[1] = qword_21458 + qword_21450;
    v17[0] = __PAIR64__(HIDWORD(v5), v8);
    while ( 1 )
    {
      v13 = *((unsigned __int8 *)v17 + (v10 >> 1));
      HIDWORD(v5) = (v10 & 1) != 0 ? v13 >> 4 : v13 & 0xF;
      if ( (_DWORD)v5 == 120 )
        break;
      v14 = BYTE4(v5) & 3;
      if ( (_DWORD)v5 == 121 )
      {
        ++v10;
        *a1 = a0123456789abcd[v14 + 8];
LABEL_11:
        v12 = *(unsigned __int8 *)++v9;
        LODWORD(v5) = v12;
        ++a1;
        if ( !v12 )
          goto LABEL_18;
      }
      else
      {
        *a1++ = v5;
        v15 = *(unsigned __int8 *)++v9;
        LODWORD(v5) = v15;
        if ( !v15 )
        {
LABEL_18:
          *a1 = v5;
          return v5;
        }
      }
    }
    ++v10;
    *a1 = a0123456789abcd[HIDWORD(v5)];
    goto LABEL_11;
  }
  while ( 1 )
  {
    v2 = (FILE *)fopen64("/dev/urandom", "rb");
    if ( !v2 )
      return -1;
    v3 = fread(&qword_21450, 1u, 0x10u, v2);
    fclose(v2);
    if ( v3 != 16 )
      return -1;
    v4 = qword_21450;
    v5 = qword_21458;
    if ( qword_21450 || qword_21458 )
    {
      dword_21448 = 1;
      goto LABEL_9;
    }
  }
}
// 10420: using guessed type int __fastcall fopen64(_DWORD, _DWORD);
// 21448: using guessed type int dword_21448;
// 21450: using guessed type __int64 qword_21450;
// 21458: using guessed type __int64 qword_21458;

//----- (000108B0) --------------------------------------------------------
int __fastcall init(int a1, int a2, int a3)
{
  int result; // r0
  int (__fastcall **v7)(int, int, int); // r5
  int v8; // r6
  int i; // r4
  int (__fastcall *v10)(int, int, int); // t1

  result = init_proc();
  v7 = (int (__fastcall **)(int, int, int))&off_20F10;
  v8 = &off_20F14 - &off_20F10;
  if ( v8 )
  {
    for ( i = 0; i != v8; ++i )
    {
      v10 = *v7++;
      result = v10(a1, a2, a3);
    }
  }
  return result;
}
// 20F10: using guessed type _UNKNOWN *off_20F10;
// 20F14: using guessed type _UNKNOWN *off_20F14;

//----- (000108F0) --------------------------------------------------------
void term_proc()
{
  ;
}

// nfuncs=35 queued=13 decompiled=13 lumina nreq=0 worse=0 better=0
// ALL OK, 13 function(s) have been successfully decompiled
