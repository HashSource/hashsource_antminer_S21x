//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
//

#include <stdbool.h>
#include <stdint.h>

// ------------------- Function Prototypes --------------------

int32_t axi_fpga_dev_exit(void);
int32_t axi_fpga_dev_mmap(int32_t i_a1, int32_t i_a2, int32_t i_a3);
int32_t axi_fpga_dev_open(void);
int32_t axi_fpga_dev_release(void);
int32_t device_destroy(int32_t i_a1, int32_t i_a2, int32_t i_a3, int32_t i_a4,
                       int32_t i_a5, int32_t i_a6, int32_t i_a7, int32_t i_a8);
int32_t init_module(int32_t i_a1, int32_t i_a2, int32_t i_a3);
int32_t unknown_ccc(char *p_a1);
int32_t unknown_d08(int32_t *p_a1, int32_t i_a2, int32_t *p_a3, int32_t i_a4);
int32_t unknown_d0c(int32_t i_a1, int32_t i_a2, int32_t i_a3);
int32_t unknown_d28(int32_t i_a1, int32_t i_a2);
int32_t unknown_d2c(int32_t i_a1, int32_t i_a2, int32_t *p_a3);
int32_t unknown_d30(void);
int32_t unknown_d34(int32_t i_a1, int32_t i_a2);
int32_t unknown_d38(char *p_a1, int32_t i_a2);
int32_t unknown_d48(void);
int32_t unknown_d54(int32_t i_a1, int32_t i_a2, int32_t i_a3, char *p_a4,
                    int32_t i_a5);
int32_t unknown_ec0(int32_t i_a1);
int32_t unknown_ec4(int32_t i_a1);
int32_t unknown_ecc(int32_t i_a1);
int32_t unknown_ed0(int32_t *p_a1, int32_t i_a2, int32_t i_a3);
int32_t unknown_ee8(int32_t i_a1, int32_t *p_a2);
int32_t unknown_eec(int32_t i_a1, int32_t i_a2);
int32_t unknown_efc(int32_t i_a1);

// --------------------- Global Variables ---------------------

int32_t i_g1 = 0x14000000;  // 0x1
int32_t i_g2 = -0x1c600000; // 0x24
int32_t i_g3 = -0x1ed000e2; // 0x28
int32_t i_g4;               // 0x4
int32_t i_g5;               // 0x54c
int32_t i_g6;               // 0xc64
int32_t i_g7;               // 0xc68
int32_t i_g8;               // 0xc70
int32_t i_g9;               // 0xc74
int32_t i_g10;              // 0xcb4

// ------------------------ Functions -------------------------

// Address range: 0x24 - 0x2c
int32_t axi_fpga_dev_open(void) {
    // 0x24
    return 0;
}

// Address range: 0x2c - 0x84
int32_t axi_fpga_dev_mmap(int32_t i_a1, int32_t i_a2, int32_t i_a3) {
    int32_t *p_v1 = (int32_t *)(i_a2 + (int32_t)&i_g3); // 0x34
    int32_t *p_v2 = (int32_t *)(i_a2 + (int32_t)&i_g2); // 0x38
    int32_t i_v3 = *p_v2 & -61;                         // 0x44
    *p_v1 = *p_v1 | 0x4044000;
    *p_v2 = i_v3;
    int32_t i_v4 = *(int32_t *)(i_a2 + (int32_t)&i_g4); // 0x54
    int32_t i_v5 = 0;                                   // 0x6c
    int32_t i_v6;                                       // 0x2c
    if (device_destroy(i_a2, i_a2, 0x40000, i_v4 - i_a2, i_v3, i_a2, i_a3,
                       i_v6) != 0) {
        // 0x70
        unknown_ccc("axi_fpga_dev_mmap error!\n");
        i_v5 = -11;
    }
    // 0x7c
    return i_v5;
}

// Address range: 0x88 - 0x90
int32_t axi_fpga_dev_release(void) {
    // 0x88
    return 0;
}

// Address range: 0x90 - 0x1f0
int32_t init_module(int32_t i_a1, int32_t i_a2, int32_t i_a3) {
    // 0x90
    unknown_d38("In axi fpga driver!\n", i_a2);
    int32_t i_v1 =
        unknown_d08(&i_g6, 0, &i_g1, (int32_t) "axi_fpga_dev"); // 0xb4
    int32_t i_v2 = (int32_t) "alloc axi_fpga_dev fail!\n";      // 0xc0
    int32_t i_v3 = 0;                                           // 0xc0
    int32_t i_v4 = i_v1;                                        // 0xc0
    int32_t i_v5;                                               // 0x90
    int32_t i_v6;                                               // 0x90
    if (i_v1 >= 0) {
        int32_t i_v7 = unknown_d28(*(int32_t *)3284, 0x24000c0); // 0xd0
        *(int32_t *)3176 = i_v7;
        i_v5 = (int32_t) "kmalloc cdev fail!\n";
        i_v6 = 0x24000c0;
        if (i_v7 == 0) {
            goto lab_0x148;
        } else {
            // 0xe4
            unknown_d48();
            i_v3 = i_g6;
            *(int32_t *)(i_g7 + (int32_t)&i_g2) = (int32_t)&i_g5;
            i_v4 = unknown_d2c(i_g7, i_v3, &i_g1);
            i_v2 = (int32_t) "add axi_fpga_dev fail!\n";
            if (i_v4 == 0) {
                int32_t i_v8 = unknown_d54(3252, 0x40000000, 0x1400,
                                           "axi_fpga_vir_mem", 0); // 0x134
                *(int32_t *)3180 = i_v8;
                i_v5 = (int32_t) "request_mem_region failed!\n";
                i_v6 = 0x40000000;
                if (i_v8 != 0) {
                    // 0x154
                    unknown_d38("request_mem_region OK!\n", 0x40000000);
                    int32_t i_v9 = unknown_d34(0x40000000, 0x1400); // 0x164
                    *(int32_t *)3184 = i_v9;
                    if (i_v9 == 0) {
                        // 0x178
                        unknown_d38("ioremap fail!\n", 0);
                        unknown_d38("!!!*base_vir_addr = 0x%x\n", i_g8);
                        // 0x114
                        return -1;
                    }
                    // 0x194
                    __asm_dsb(
                        unknown_d38("AXI fpga dev virtual address is 0x%x\n",
                                    i_v9),
                        i_g8);
                    unknown_d38("*base_vir_addr = 0x%x\n", i_g8);
                    int32_t i_v10 =
                        unknown_d0c((int32_t)&i_g5, (int32_t) "axi_fpga_dev",
                                    3188); // 0x1bc
                    i_g9 = i_v10;
                    int32_t i_v11; // 0x90
                    if (i_v10 == -0x1000 || i_v10 <= 0xffffefff) {
                        // 0x1d8
                        unknown_d30();
                        i_v11 = 0;
                    } else {
                        // 0x1cc
                        unknown_d38("Err:failed in creating axi fpga class.\n",
                                    (int32_t) "axi_fpga_dev");
                        i_v11 = -1;
                    }
                    // 0x114
                    return i_v11;
                }
                goto lab_0x148;
            } else {
                goto lab_0x110;
            }
        }
    } else {
        goto lab_0x110;
    }
lab_0x110:
    // 0x110
    unknown_d38((char *)i_v2, i_v3);
    // 0x114
    return i_v4;
lab_0x148:
    // 0x148
    unknown_d38((char *)i_v5, i_v6);
    // 0x114
    return &i_g1;
}

// Address range: 0x23c - 0x298
int32_t axi_fpga_dev_exit(void) {
    // 0x23c
    unknown_ee8(i_g6, &i_g1);
    unknown_efc(i_g7);
    unknown_ecc(i_g7);
    unknown_ec4(i_g8);
    unknown_ed0(&i_g10, 0x40000000, 0x1400);
    unknown_eec(i_g9, i_g6);
    unknown_ec0(i_g9);
    while (true) {
        // continue -> 0x294
    }
}

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (7.2.1)
// Detected functions: 5
